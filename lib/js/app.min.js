!function(){"use strict";angular.module("inmateManager",["ui.router","LocalStorageModule"]).config(function(a,b){b.otherwise("/"),a.state("main",{url:"/",templateUrl:"src/views/main.html",controller:"mainCtrl as main"}).state("main.inmates",{url:"people",templateUrl:"src/views/inmates.html",controller:"inmatesCtrl as inmates"}).state("main.crimes",{url:"parameters",templateUrl:"src/views/crimes.html",controller:"crimesCtrl as crimes"}).state("main.manager",{url:"manager",templateUrl:"src/views/manager.html",controller:"managerCtrl as manager"})})}(),function(){angular.module("inmateManager").service("CrimesService",function(a){function b(a){f=a}function c(){return f?f:[]}function d(){var a=$.ajax({method:"GET",url:"https://inmatesearch.herokuapp.com/api/nc/durham/crimes",success:function(a){},error:function(a){}});return a}function e(a){var b={query:{name:a.name},update:{name:a.name,bailable:a.bailable}};if(a.label){var c={name:a.label.name,bailable:a.label.bailable};b.update.label=c}var d=$.ajax({method:"PUT",url:"https://inmatesearch.herokuapp.com/api/nc/durham/crimes",data:b,success:function(a){},error:function(a){}});return d}var f;return{setCrimeList:b,getCrimeList:c,getCrimes:d,updateCrime:e}})}(),function(){angular.module("inmateManager").service("InmateService",function(a,b){function c(a){i=a}function d(){return i?i:[]}function e(){var a=$.ajax({method:"GET",url:"https://inmatesearch.herokuapp.com/api/nc/durham/inmates",success:function(a){},error:function(a){}});return a}function f(a){var b=$.ajax({method:"POST",url:"https://inmatesearch.herokuapp.com/api/inmatemanager/inmates",data:a,success:function(a){},error:function(a){}});return b}function g(a){var c=!0,d=b.getCrimeList();a.charges.forEach(function(a){d.forEach(function(b){a.description==b.name&&"No"==b.bailable&&(c=!1),"[N/A]"!=a.bondType&&"NO BOND"!=a.bondType&&"NB"!=a.bondType||(c=!1)})}),a.totalBailAmount<=2e3&&c?a.bailability="Yes":a.bailability="No"}function h(){var a=$.ajax({method:"GET",url:"https://inmatesearch.herokuapp.com/api/nc/durham/inmates/download",success:function(a){},error:function(a){}});return a}var i;return{setInmateList:c,getInmateList:d,getInmates:e,addInmate:f,checkBailability:g,getInmatesCSV:h}})}(),function(){angular.module("inmateManager").service("LabelService",function(a){function b(a){g=a}function c(){return g?g:[]}function d(){var a=$.ajax({method:"GET",url:"https://inmatesearch.herokuapp.com/api/nc/durham/labels",success:function(a){},error:function(a){}});return a}function e(a){var b={query:{name:a.name},update:{name:a.name,bailable:a.bailable}},c=$.ajax({method:"PUT",url:"https://inmatesearch.herokuapp.com/api/nc/durham/labels",data:b,success:function(a){},error:function(a){}});return c}function f(a){var b=$.ajax({method:"POST",url:"https://inmatesearch.herokuapp.com/api/nc/durham/labels",data:a,success:function(a){},error:function(a){}});return b}var g;return{setLabelList:b,getLabelList:c,getLabels:d,updateLabel:e,createLabel:f}})}(),function(){angular.module("inmateManager").service("ManagerService",function(a){function b(){var a=$.ajax({method:"GET",url:"https://inmatesearch.herokuapp.com/api/nc/durham/inmates",success:function(a){},error:function(a){}});return a}function c(a){var b=$.ajax({method:"POST",url:"https://inmatesearch.herokuapp.com/api/inmatemanager/inmates",data:a,success:function(a){},error:function(a){}});return b}return{getInmates:b,addInmate:c}})}(),function(){angular.module("inmateManager").service("UserService",function(a){function b(a){var b=$.ajax({method:"POST",url:"https://inmatesearch.herokuapp.com/api/nc/durham/users",data:a});return b}return{signInUser:b}})}(),angular.module("inmateManager").controller("crimesCtrl",function(a,b,c,d){var e=this;e.sortType="-bailable",e.sort=function(a){e.sortType==a?e.sortType="-"+a:e.sortType=="-"+a?e.sortType=a:e.sortType=a},e.updateCrime=function(b){b.label=void 0,a.updateCrime(b).done(function(a){})},e.addNewLabel=function(c){var e=prompt("Enter a name for the label: "),f={name:e,bailable:c.bailable};b.createLabel(f).done(function(a){}),d.main.labelList=b.getLabelList(),d.main.labelList.push(f),b.setLabelList(d.main.labelList),c.label=f,a.updateCrime(c).done(function(a){})},e.updateCrimeLabel=function(b){b.label?(b.bailable=b.label.bailable,a.updateCrime(b).done(function(a){})):b.bailable="Null"}}),angular.module("inmateManager").controller("inmatesCtrl",function(a,b,c){var d=this;d.searchChargesType="lessThan",d.searchBailType="lessThan",d.searchDateReleasedType="lessThan",d.searchDateChargedType="lessThan",d.searchNumCharges,d.searchBailAmount,d.searchDateReleased,d.searchDateCharged,d.totalBailAmount=0,d.sortType="name",d.sortDirection=!1,d.addInmate=function(b){a.addInmateToManager(b).done(function(a){})},d.searchCharges=function(a){return!d.searchNumCharges||("exact"==d.searchChargesType&&a.charges.length==d.searchNumCharges||("lessThan"==d.searchChargesType&&a.charges.length<=d.searchNumCharges||"greaterThan"==d.searchChargesType&&a.charges.length>=d.searchNumCharges))},d.searchTotalBail=function(a){return!d.searchBailAmount||("exact"==d.searchBailType&&a.totalBailAmount==d.searchBailAmount||("lessThan"==d.searchBailType&&a.totalBailAmount<=d.searchBailAmount||"greaterThan"==d.searchBailType&&a.totalBailAmount>=d.searchBailAmount))},d.searchDatesReleased=function(a){return!d.searchDateReleased||("exact"===d.searchDateReleasedType&&new Date(a.dateReleased).getTime()===new Date(d.searchDateReleased).getTime()||("lessThan"===d.searchDateReleasedType&&new Date(a.dateReleased).getTime()<=new Date(d.searchDateReleased).getTime()||"greaterThan"===d.searchDateReleasedType&&new Date(a.dateReleased).getTime()>=new Date(d.searchDateReleased).getTime()))},d.searchDatesCharged=function(a){return!d.searchDateCharged||("exact"===d.searchDateChargedType&&new Date(a.dateCharged).getTime()===new Date(d.searchDateCharged).getTime()||("lessThan"===d.searchDateChargedType&&new Date(a.dateCharged).getTime()<=new Date(d.searchDateCharged).getTime()||"greaterThan"===d.searchDateChargedType&&new Date(a.dateCharged).getTime()>=new Date(d.searchDateCharged).getTime()))},d.getStats=function(){d.totalBailAmount=0,d.filterResults.forEach(function(a){d.totalBailAmount+=a.totalBailAmount})},d.sort=function(a){d.sortType==a?d.sortDirection=!d.sortDirection:d.sortType=a},d.customSort=function(a,b){if("dateReleased"===d.sortType||"dateCharged"===d.sortType){if("[incarcerated]"===a.value)return-1;if("[incarcerated]"===b.value)return 1;if(new Date(a.value).getTime()<new Date(b.value).getTime())return-1;if(new Date(a.value).getTime()>new Date(b.value).getTime())return 1}else{if(a.value<b.value)return-1;if(a.value>b.value)return 1}},d.getInmatesCSV=function(){window.open("https://inmatesearch.herokuapp.com/api/nc/durham/inmates/download")}}),angular.module("inmateManager").controller("mainCtrl",function(a,b,c,d,e,f){function g(){b.getCrimes().done(function(a){d.getLabels().done(function(c){d.setLabelList(c),p.loadingLabels=!1,p.labelList=d.getLabelList(),a.forEach(function(a){if(a.bailable||(a.bailable="Null",p.updateCrime(a)),a.label){p.labelList.forEach(function(b){b.name===a.label.name&&(a.label=b)})}}),b.setCrimeList(a),p.loadingCrimes=!1,p.loadingCrimes||p.loadingInmates||p.loadingLabels||(p.loading=!1),p.crimeList=b.getCrimeList(),f.$apply()})})}function h(){a.getInmates().done(function(b){b.forEach(function(b){a.checkBailability(b)}),a.setInmateList(b),p.loadingInmates=!1,p.loadingCrimes||p.loadingInmates||p.loadingLabels||(p.loading=!1),p.inmateList=a.getInmateList(),f.$apply()})}function i(a){c.signInUser(a).done(function(a){var b=a.result.value;b.super&&(g(),h(),p.validUser=!0),p.signedIn=!0,p.user=b,f.$apply()}).fail(function(a){p.signOut()})}function j(){return t}function k(){gapi.client.setApiKey(r),gapi.auth2.init({client_id:s,scope:"profile"}).then(function(){q=gapi.auth2.getAuthInstance(),q.isSignedIn.listen(l),l(q.isSignedIn.get())})}function l(a){a?o():(p.signedIn=!1,f.$apply())}function m(){q.signIn({prompt:"login"})}function n(){q.signOut()}function o(){var a=gapi.client.request({path:"https://people.googleapis.com/v1/people/me",method:"GET"});a.then(function(a){t.name=a.result.names[0].displayName,t.picture=a.result.photos[0].url,t.uid=q.currentUser.Ab.El,t.token=q.currentUser.Ab.Zi.access_token,i(t)})}var p=this;p.signedIn=!1,p.loading=!0,p.loadingLabels=!0,p.loadingCrimes=!0,p.loadingInmates=!0,p.user=j(),p.validUser=!1,p.crimeList=b.getCrimeList(),p.inmateList=a.getInmateList(),p.labelList=d.getLabelList(),p.updateCrime=function(a){b.updateCrime(a).done(function(a){})},p.signIn=function(){m()},p.signOut=function(){p.validUser=!1,n()};var q,r="AIzaSyCnkQqRkK-S9tWGZkRnjNVeVGwYsAZG5D4",s="80279716609-tbtbobnu30bdoq56imdr0a9gncqcn4il.apps.googleusercontent.com",t={name:null,uid:null,token:null,picture:null};gapi.load("client:auth2",k)}),angular.module("inmateManager").controller("managerCtrl",function(a,b,c){});